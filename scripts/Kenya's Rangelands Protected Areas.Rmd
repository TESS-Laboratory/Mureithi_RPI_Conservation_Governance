---
title: "Kenya's Rangelands Protected Areas"
author: "Isaac Mureithi"
date: "2025-04-01"
output:
  html_document: default
  pdf_document: default
  word_document: default
---

```{r}
# Load libraries

if (!require("pacman")) install.packages("pacman")

pacman::p_load(sf, terra, tidyverse, tidyterra, colorspace, ggrepel, patchwork, tmap, trend)
```

```{r}
# Set theme for plots

theme_beautiful <- function() {
  theme_bw() +
    theme(
      text = element_text(family = "Helvetica"),
      axis.text = element_text(size = 8, color = "black"),
      axis.title = element_text(size = 8, color = "black"),
      axis.line.x = element_line(linewidth = 0.3, color = "black"), # Use linewidth
      axis.line.y = element_line(linewidth = 0.3, color = "black"), # Use linewidth
      axis.ticks = element_line(linewidth = 0.3, color = "black"), # Use linewidth
      panel.border = element_blank(),
      panel.grid.major.x = element_blank(),
      panel.grid.minor.x = element_blank(),
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), "cm"),
      plot.title = element_text(
        size = 8,
        vjust = 1,
        hjust = 0.5,
        color = "black"
      ),
      legend.text = element_text(size = 8, color = "black"),
      legend.title = element_text(size = 8, color = "black"),
      legend.position = "right", # Move legend to the right
      legend.key.size = unit(0.9, "line"),
      legend.background = element_rect(
        color = "black",
        fill = "transparent",
        linewidth = 0.3, # Use linewidth
        linetype = "blank"
      )
    )
}

# Attempt to set the Helvetica font (may not work on all systems)
if (Sys.info()[["sysname"]] == "Windows") {
  windowsFonts("Helvetica" = windowsFont("Helvetica"))
}
```

```{r}
# World Map Import

Global.Country.Boundaries <- st_read("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/2.Kenya-s-Rangelands-Protected-Areas_files/additional_data_layers_wgs84/global_country_boundaries_simplified_wgs84.shp")
```

```{r}
# Plot of World Map

ggplot() +
  geom_sf(data = Global.Country.Boundaries)+
  labs(title = "World Country Map")+
  theme_beautiful()
```

```{r}
# Africa Country Boundary import

Africa.Country.Boundaries <- st_read("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/2.Kenya-s-Rangelands-Protected-Areas_files/additional_data_layers_wgs84/africa_country_boundaries_simplified_wgs84.shp")
```

```{r}
# Focusing on Eastern Africa

Eastern.Africa.Country.ISOCodes <- c("BI", "DJ", "ER", "ET", "KE", "RW", "SO", "TZ", "UG")
Eastern.Africa.Data <- Africa.Country.Boundaries %>% 
  filter(ISO_Code %in% Eastern.Africa.Country.ISOCodes)
```

```{r}
# Plotting with a focus on Eastern Africa

ggplot() +
  geom_sf(data = Global.Country.Boundaries, fill = "white", colour = "grey") +
  geom_sf(data = Africa.Country.Boundaries, aes(fill = "Africa"), colour = "grey", alpha = 0.5) +
  geom_sf(data = Eastern.Africa.Data, aes(fill = "Eastern Africa"), colour = "black") +
  scale_fill_manual(values = c("Africa" = "lightgreen", "Eastern Africa" = "darkgreen"),
                    name = "Region",labels = c("Africa", "Eastern Africa")) +
  labs(title = "Eastern Africa in World Map")+
  theme_beautiful()
```

```{r}
#Focusing on Kenya

  Kenya.Admin.Boundary <- st_read("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/2.Kenya-s-Rangelands-Protected-Areas_files/additional_data_layers_wgs84/kenya_admin_boundary_wgs84.shp")
```

```{r}
# Plotting Kenya

ggplot() +
  geom_sf(data = Eastern.Africa.Data, aes(fill = "Eastern Africa"), alpha = 0.5, colour = NA) +
  geom_sf(data = Kenya.Admin.Boundary, aes(fill = "Kenya"), colour = "black") +
  scale_fill_manual(name = "Region",values = c("Eastern Africa" = "darkgreen", "Kenya" = "lightgreen"))+
  labs(title = "Kenya Administrative Boundary") +
  theme_beautiful()
```

```{r}
#Focusing on Boundaries within Kenya

Kenya.Regional.Admin.Boundary <- st_read("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/2.Kenya-s-Rangelands-Protected-Areas_files/additional_data_layers_wgs84/kenya_regional_admin1_boundary_wgs84.shp")
```

```{r}
# Plotting Kenya's Regional Boundaries

ggplot()+
  geom_sf(data = Kenya.Admin.Boundary, colour = "black")+
  geom_sf(data = Kenya.Regional.Admin.Boundary, colour = "grey50")+
  labs(title = "Kenya's Subregional Administrative Boundaries") +
  theme_beautiful()
```

```{r}
# Focusing on Kenya's Terrestrial Protected Areas

Kenya.Terrestrial.PAs <- st_read("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/2.Kenya-s-Rangelands-Protected-Areas_files/additional_data_layers_wgs84/kenya_terrestrial_protected_areas_wgs84.shp")
```

```{r}
# Plotting Kenya's Terrestrial PAs

ggplot()+
  geom_sf(data = Kenya.Admin.Boundary, colour = "black")+
  geom_sf(data = Kenya.Regional.Admin.Boundary, colour = "grey50")+
  geom_sf(data = Kenya.Terrestrial.PAs, aes(fill = "Protected Areas"), alpha = 0.5)+
  scale_fill_manual(values = c("Protected Areas" = "brown"),name = "Legend",labels = c("Protected Areas")) +
  labs(title = "Kenya's Terrestrial Protected Areas") +
  theme_beautiful()
```

```{r}
# Focusing on Kenya's Rangelands (80& of Kenya's LandMass)

Rangeland.Counties <- c("Marsabit", "Isiolo", "Meru", "Tharaka-Nithi", "Embu", 
                        "Kitui", "Makueni", "Tana River", "Lamu", "Taita Taveta",
                        "Garissa", "Wajir", "Mandera", "Turkana", "West Pokot",
                        "Samburu", "Baringo", "Laikipia", "Narok", "Kajiado")

Kenya.Rangeland.Counties <- Kenya.Regional.Admin.Boundary %>% 
  filter(ADM1_EN %in% Rangeland.Counties)
```

```{r}
# Plotting the Rangeland Counties

ggplot()+
  geom_sf(data = Kenya.Admin.Boundary, colour = "black") +
  geom_sf(data = Kenya.Regional.Admin.Boundary, colour = "grey50") +
  geom_sf(data = Kenya.Rangeland.Counties, aes(fill = "Rangeland Counties")) +
  scale_fill_manual(values = c("Rangeland Counties" = "grey"),name = "Legend",labels = c("Rangeland Counties")) +
  labs(title = "Kenya's Rangeland Counties") +
  theme_beautiful()
```

```{r}
# Importing RPI Datasets - Rasters (TIFs)

Actual.GPP <- rast("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/2.Kenya-s-Rangelands-Protected-Areas_files/RPI Datasets (GuyLomax)/actual_gpp_ea_v2.tif")

Potential.GPP <- rast("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/2.Kenya-s-Rangelands-Protected-Areas_files/RPI Datasets (GuyLomax)/potential_gpp_ea_v2.tif")

RPI <- rast("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/2.Kenya-s-Rangelands-Protected-Areas_files/RPI Datasets (GuyLomax)/rpi_ea_v2.tif")
```

```{r}
# MAPS SOURCED FROM WDPA

# "UNEP-WCMC and IUCN (2025), Protected Planet: The World Database on Protected Areas (WDPA) and World Database on Other Effective Area-based Conservation Measures (WD-OECM) [Online], April 2025, Cambridge, UK: UNEP-WCMC and IUCN. Available at: www.protectedplanet.net." 
```

```{r}
# Importing National Parks & National Reserves (GAE/TCA)

Amboseli <- st_read("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/4.WDPA-GAE&TSAVOs/National Parks&Reserves/Amboseli-WDPA_WDOECM_Apr2025_Public_758_shp/WDPA_WDOECM_Apr2025_Public_758_shp_0/WDPA_WDOECM_Apr2025_Public_758_shp-polygons.shp")

ChyuluHills <- st_read("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/4.WDPA-GAE&TSAVOs/National Parks&Reserves/ChyuluHills-WDPA_WDOECM_Apr2025_Public_19563_shp/WDPA_WDOECM_Apr2025_Public_19563_shp_0/WDPA_WDOECM_Apr2025_Public_19563_shp-polygons.shp")

TsavoWest <- st_read("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/4.WDPA-GAE&TSAVOs/National Parks&Reserves/TsavoWest-WDPA_WDOECM_Apr2025_Public_19564_shp/WDPA_WDOECM_Apr2025_Public_19564_shp_0/WDPA_WDOECM_Apr2025_Public_19564_shp-polygons.shp")

TsavoEast <- st_read("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/4.WDPA-GAE&TSAVOs/National Parks&Reserves/TsavoEast-WDPA_WDOECM_Apr2025_Public_752_shp/WDPA_WDOECM_Apr2025_Public_752_shp_0/WDPA_WDOECM_Apr2025_Public_752_shp-polygons.shp")

NgaiNdethia <- st_read("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/4.WDPA-GAE&TSAVOs/National Parks&Reserves/NgaiNdethia-WDPA_WDOECM_Apr2025_Public_2595_shp/WDPA_WDOECM_Apr2025_Public_2595_shp_0/WDPA_WDOECM_Apr2025_Public_2595_shp-polygons.shp")

SouthKitui <- st_read("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/4.WDPA-GAE&TSAVOs/National Parks&Reserves/SouthKitui-WDPA_WDOECM_Apr2025_Public_2590_shp/WDPA_WDOECM_Apr2025_Public_2590_shp_0/WDPA_WDOECM_Apr2025_Public_2590_shp-polygons.shp")
```

```{r}
# Visualising GAE/TCA

ggplot() +
  geom_sf(data = Amboseli, aes(fill = NAME), color = "black", linewidth = 0.3) +
  geom_sf(data = ChyuluHills, aes(fill = NAME), color = "black", linewidth = 0.3) +
  geom_sf(data = TsavoEast, aes(fill = NAME), color = "black", linewidth = 0.3) +
  geom_sf(data = TsavoWest, aes(fill = NAME), color = "black", linewidth = 0.3) +
  geom_sf(data = NgaiNdethia, aes(fill = NAME), color = "black", linewidth = 0.3) +
  geom_sf(data = SouthKitui, aes(fill = NAME), color = "black", linewidth = 0.3) +
  labs(title = "National Parks and Reserves - GAE/TCA", fill = "Protected Area") +
  theme_beautiful()
```

```{r}
# Importing Community Conservancies & Group Ranches

AET.Conservancies <- st_read("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/5. AET-Conservancies/AET_Conservancies.shp")

AET.Buffers <- st_read("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/5. AET-Conservancies/AET_Other_Conserved_Areas.shp")

DawidaRanch_T <- st_read("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/4.WDPA-GAE&TSAVOs/Community&Groups/DawidaRanch(T)-WDPA_WDOECM_Apr2025_Public_72297_shp/WDPA_WDOECM_Apr2025_Public_72297_shp_0/WDPA_WDOECM_Apr2025_Public_72297_shp-points.shp")

Kasigau_T <- st_read("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/4.WDPA-GAE&TSAVOs/Community&Groups/Kasigau(T)-WDPA_WDOECM_Apr2025_Public_7582_shp/WDPA_WDOECM_Apr2025_Public_7582_shp_0/WDPA_WDOECM_Apr2025_Public_7582_shp-polygons.shp")

MbuliaGroupRanch_T <- st_read("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/4.WDPA-GAE&TSAVOs/Community&Groups/MbuliaGroupRanch(T)-WDPA_WDOECM_Apr2025_Public_72293_shp/WDPA_WDOECM_Apr2025_Public_72293_shp_0/WDPA_WDOECM_Apr2025_Public_72293_shp-points.shp")

Mnjonyi_T <- st_read("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/4.WDPA-GAE&TSAVOs/Community&Groups/Mnjonyi(T)-WDPA_WDOECM_Apr2025_Public_555785981_shp/WDPA_WDOECM_Apr2025_Public_555785981_shp_0/WDPA_WDOECM_Apr2025_Public_555785981_shp-polygons.shp")

Mwaganini_T <- st_read("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/4.WDPA-GAE&TSAVOs/Community&Groups/Mwaganini(T)-WDPA_WDOECM_Apr2025_Public_555785983_shp/WDPA_WDOECM_Apr2025_Public_555785983_shp_0/WDPA_WDOECM_Apr2025_Public_555785983_shp-polygons.shp")

Ronge_T <- st_read("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/4.WDPA-GAE&TSAVOs/Community&Groups/Ronge(T)-WDPA_WDOECM_Apr2025_Public_555785982_shp/WDPA_WDOECM_Apr2025_Public_555785982_shp_0/WDPA_WDOECM_Apr2025_Public_555785982_shp-polygons.shp")

TaitaHills_T <- st_read("C:/BIOM4009 ResearchProject/DATA/Geospatial Data/R Use/4.WDPA-GAE&TSAVOs/Community&Groups/TaitaHills(T)-WDPA_WDOECM_Apr2025_Public_7408_shp/WDPA_WDOECM_Apr2025_Public_7408_shp_0/WDPA_WDOECM_Apr2025_Public_7408_shp-polygons.shp")
```

```{r}
# Visualising the Community Conservancies & Group Ranches within GAE/TCA

ggplot()+
  geom_sf(data = AET.Conservancies, aes(fill = consv_name), color = "black", linewidth = 0.1) +
  geom_sf(data = AET.Buffers, aes(fill = consv_name), color = "black", linewidth = 0.1) +
  geom_sf(data = DawidaRanch_T, aes(fill = NAME), color = 'black', linewidth = 0.1) +
  geom_sf(data = Kasigau_T, aes(fill = NAME), color = 'black', linewidth = 0.1) +
  geom_sf(data = Mnjonyi_T, aes(fill = NAME), color = 'black', linewidth = 0.1) +
  geom_sf(data = MbuliaGroupRanch_T, aes(fill = NAME), color = 'black', linewidth = 0.1) +
  geom_sf(data = Mwaganini_T, aes(fill = NAME), color = 'black', linewidth = 0.1) +
  geom_sf(data = Ronge_T, aes(fill = NAME), color = 'black', linewidth = 0.1) +
  geom_sf(data = TaitaHills_T, aes(fill = NAME), color = 'black', linewidth = 0.1) +
  labs(title = "Community & Group Ranches in GAE/TCA") +
  theme_beautiful()
```

```{r}
# Visualising the Community & Group Lands surrounding Amboseli NP

AET.Conservancies.Plot <- ggplot()+
  geom_sf(data = Amboseli, aes(fill = NAME), color = "black", linewidth = 0.3) +
  geom_sf(data = AET.Conservancies, aes(fill = consv_name), color = "black", linewidth = 0.1) +
  labs(title = "Community & Group Lands surrounding Amboseli NP") +
  theme_beautiful()
```

```{r}
# Visualising the Community & Group Rangelands/Grazelands/Buffers surrounding Amboseli NP

AET.Buffers.Plot <- ggplot()+
 geom_sf(data = Amboseli, aes(fill = NAME), color = "black", linewidth = 0.3) +
  geom_sf(data = AET.Buffers, aes(fill = consv_name), color = "black", linewidth = 0.1) +
  labs(title = "Bufferzones, Corridors & Grazelands surrounding Amboseli NP") +
  theme_beautiful()
```

```{r}
# Combining the two plots showing Community Lands for Amboseli NP
AET.Conservancies.Plot + AET.Buffers.Plot + plot_layout(ncol = 1) +
  plot_annotation(title = "Community & Group Lands surrounding Amboseli NP",
                  theme = theme(plot.title = element_text(hjust = 0.5)))
```

```{r}
# Visualising RPI for each Area
```

```{r}
## Visualising Amboseli NP

Amboseli.RPI.Mask <- mask(RPI, Amboseli)
Amboseli.RPI.Crop <- crop(Amboseli.RPI.Mask, Amboseli)

# Averaging across years for visualization
Amboseli.RPI.Mean <- mean(Amboseli.RPI.Crop, na.rm = TRUE)

# Visualise
tmap_mode("view")
tm_shape(Amboseli.RPI.Mean) +
  tm_raster(col.scale = tm_scale_continuous(values = "viridis"), 
            col.legend = tm_legend(title = "Mean RPI")) +
  tm_shape(Amboseli) +
  tm_borders(col = "white", lwd = 2) +
  tm_title("Spatial Distribution of Mean RPI in Amboseli NP") +
  tm_layout(legend.outside = TRUE)
```

```{r}
## Visualising Tsavo East NP

TsavoEast.RPI.Mask <- mask(RPI, TsavoEast)
TsavoEast.RPI.Crop <- crop(TsavoEast.RPI.Mask, TsavoEast)

# Averaging across years for visualization
TsavoEast.RPI.Mean <- mean(TsavoEast.RPI.Crop, na.rm = TRUE)

# Visualise
tmap_mode("view")
tm_shape(TsavoEast.RPI.Mean) +
  tm_raster(col.scale = tm_scale_continuous(values = "viridis"), 
            col.legend = tm_legend(title = "Mean RPI")) +
  tm_shape(TsavoEast) +
  tm_borders(col = "white", lwd = 2) +
  tm_title("Spatial Distribution of Mean RPI in Tsavo East NP") +
  tm_layout(legend.outside = TRUE)
```

```{r}
## Visualising Tsavo West NP

TsavoWest.RPI.Mask <- mask(RPI, TsavoWest)
TsavoWest.RPI.Crop <- crop(TsavoWest.RPI.Mask, TsavoWest)

# Averaging across years for visualization
TsavoWest.RPI.Mean <- mean(TsavoWest.RPI.Crop, na.rm = TRUE)

# Visualise
tmap_mode("view")
tm_shape(TsavoWest.RPI.Mean) +
  tm_raster(col.scale = tm_scale_continuous(values = "viridis"), 
            col.legend = tm_legend(title = "Mean RPI")) +
  tm_shape(TsavoWest) +
  tm_borders(col = "white", lwd = 2) +
  tm_title("Spatial Distribution of Mean RPI in Tsavo West NP") +
  tm_layout(legend.outside = TRUE)
```

```{r}
## Visualising Chyulu Hills NP

ChyuluHills.RPI.Mask <- mask(RPI, ChyuluHills)
ChyuluHills.RPI.Crop <- crop(ChyuluHills.RPI.Mask, ChyuluHills)

# Averaging across years for visualization
ChyuluHills.RPI.Mean <- mean(ChyuluHills.RPI.Crop, na.rm = TRUE)

# Visualise
tmap_mode("view")
tm_shape(ChyuluHills.RPI.Mean) +
  tm_raster(col.scale = tm_scale_continuous(values = "viridis"), 
            col.legend = tm_legend(title = "Mean RPI")) +
  tm_shape(ChyuluHills) +
  tm_borders(col = "white", lwd = 2) +
  tm_title("Spatial Distribution of Mean RPI in Chyulu Hills NP") +
  tm_layout(legend.outside = TRUE)
```

```{r}
## Visualising Ngai Ndethia NR

NgaiNdethia.RPI.Mask <- mask(RPI, NgaiNdethia)
NgaiNdethia.RPI.Crop <- crop(NgaiNdethia.RPI.Mask, NgaiNdethia)

# Averaging across years for visualization
NgaiNdethia.RPI.Mean <- mean(NgaiNdethia.RPI.Crop, na.rm = TRUE)

# Visualise
tmap_mode("view")
tm_shape(NgaiNdethia.RPI.Mean) +
  tm_raster(col.scale = tm_scale_continuous(values = "viridis"), 
            col.legend = tm_legend(title = "Mean RPI")) +
  tm_shape(NgaiNdethia) +
  tm_borders(col = "white", lwd = 2) +
  tm_title("Spatial Distribution of Mean RPI in Ngai Ndethia NR") +
  tm_layout(legend.outside = TRUE)
```

```{r}
## Visualising South Kitui NR

SouthKitui.RPI.Mask <- mask(RPI, SouthKitui)
SouthKitui.RPI.Crop <- crop(SouthKitui.RPI.Mask, SouthKitui)

# Averaging across years for visualization
SouthKitui.RPI.Mean <- mean(SouthKitui.RPI.Crop, na.rm = TRUE)

# Visualise
tmap_mode("view")
tm_shape(SouthKitui.RPI.Mean) +
  tm_raster(col.scale = tm_scale_continuous(values = "viridis"), 
            col.legend = tm_legend(title = "Mean RPI")) +
  tm_shape(SouthKitui) +
  tm_borders(col = "white", lwd = 2) +
  tm_title("Spatial Distribution of Mean RPI in South Kitui NR") +
  tm_layout(legend.outside = TRUE)
```

```{r}
## Visualising AET.Conservancies

AET.Conservancies.RPI.Mask <- mask(RPI, AET.Conservancies)
AET.Conservancies.RPI.Crop <- crop(AET.Conservancies.RPI.Mask, AET.Conservancies)

# Averaging across years for visualization
AET.Conservancies.RPI.Mean <- mean(AET.Conservancies.RPI.Crop, na.rm = TRUE)

# Visualise
tmap_mode("view")
tm_shape(AET.Conservancies.RPI.Mean) +
  tm_raster(col.scale = tm_scale_continuous(values = "viridis"), 
            col.legend = tm_legend(title = "Mean RPI")) +
  tm_shape(AET.Conservancies) +
  tm_borders(col = "white", lwd = 2) +
  tm_title("Spatial Distribution of Mean RPI in AET Conservancies") +
  tm_layout(legend.outside = TRUE)
```

```{r}
## Visualising AET.Buffers

AET.Buffers.RPI.Mask <- mask(RPI, AET.Buffers)
AET.Buffers.RPI.Crop <- crop(AET.Buffers.RPI.Mask, AET.Buffers)

# Averaging across years for visualization
AET.Buffers.RPI.Mean <- mean(AET.Buffers.RPI.Crop, na.rm = TRUE)

# Visualise
tmap_mode("view")
tm_shape(AET.Buffers.RPI.Mean) +
  tm_raster(col.scale = tm_scale_continuous(values = "viridis"), 
            col.legend = tm_legend(title = "Mean RPI")) +
  tm_shape(AET.Buffers) +
  tm_borders(col = "white", lwd = 2) +
  tm_title("Spatial Distribution of Menean RPI in AET Buffers") +
  tm_layout(legend.outside = TRUE)
```

```{r}
# Extracting RPI Values for each Area
```

```{r}
## Extracting RPI for Amboseli NP

Amboseli.RPI.Values.Full <- terra::extract(Amboseli.RPI.Crop, Amboseli, cells = TRUE)

### Remove ID column (first column added by extract)
Amboseli.RPI.Values <- Amboseli.RPI.Values.Full[, names(Amboseli.RPI.Crop)]

Amboseli.Summary <- data.frame(
  Layer = names(Amboseli.RPI.Crop),
  Mean = apply(Amboseli.RPI.Values, 2, mean, na.rm = TRUE),
  SD = apply(Amboseli.RPI.Values, 2, sd, na.rm = TRUE),
  Q25 = apply(Amboseli.RPI.Values, 2, quantile, probs = 0.25, na.rm = TRUE),
  Median = apply(Amboseli.RPI.Values, 2, median, na.rm = TRUE),
  Q75 = apply(Amboseli.RPI.Values, 2, quantile, probs = 0.75, na.rm = TRUE)
)

print(Amboseli.Summary)
```

```{r}
## Extracting RPI for TsavoEast NP

TsavoEast.RPI.Values.Full <- terra::extract(TsavoEast.RPI.Crop, TsavoEast, cells= TRUE)

### Remove ID column (first column added by extract)
TsavoEast.RPI.Values <- TsavoEast.RPI.Values.Full[,names(TsavoEast.RPI.Crop)]

TsavoEast.Summary <- data.frame(
  Layer = names(TsavoEast.RPI.Crop),
  Mean = apply(TsavoEast.RPI.Values, 2, mean, na.rm = TRUE),
  SD = apply(TsavoEast.RPI.Values, 2, sd, na.rm = TRUE),
  Q25 = apply(TsavoEast.RPI.Values, 2, quantile, probs = 0.25, na.rm = TRUE),
  Median = apply(TsavoEast.RPI.Values, 2, median, na.rm = TRUE),
  Q75 = apply(TsavoEast.RPI.Values, 2, quantile, probs = 0.75, na.rm = TRUE)
)

print(TsavoEast.Summary)
```

```{r}
## Extracting RPI for TsavoWest NP

TsavoWest.RPI.Values.Full <- terra::extract(TsavoWest.RPI.Crop, TsavoWest, cells= TRUE)

### Remove ID column (first column added by extract)
TsavoWest.RPI.Values <- TsavoWest.RPI.Values.Full[, names(TsavoWest.RPI.Crop)]

TsavoWest.Summary <- data.frame(
  Layer = names(TsavoWest.RPI.Crop),
  Mean = apply(TsavoWest.RPI.Values, 2, mean, na.rm = TRUE),
  SD = apply(TsavoWest.RPI.Values, 2, sd, na.rm = TRUE),
  Q25 = apply(TsavoWest.RPI.Values, 2, quantile, probs = 0.25, na.rm = TRUE),
  Median = apply(TsavoWest.RPI.Values, 2, median, na.rm = TRUE),
  Q75 = apply(TsavoWest.RPI.Values, 2, quantile, probs = 0.75, na.rm = TRUE)
)

print(TsavoWest.Summary)
```

```{r}
## Extracting RPI for ChyuluHills NP

ChyuluHills.RPI.Values.Full <- terra::extract(ChyuluHills.RPI.Crop, ChyuluHills, cells = TRUE)

### Remove ID column (first column added by extract)
ChyuluHills.RPI.Values <- ChyuluHills.RPI.Values.Full[, names(ChyuluHills.RPI.Crop)]

ChyuluHills.Summary <- data.frame(
  Layer = names(ChyuluHills.RPI.Crop),
  Mean = apply(ChyuluHills.RPI.Values, 2, mean, na.rm = TRUE),
  SD = apply(ChyuluHills.RPI.Values, 2, sd, na.rm = TRUE),
  Q25 = apply(ChyuluHills.RPI.Values, 2, quantile, probs = 0.25, na.rm = TRUE),
  Median = apply(ChyuluHills.RPI.Values, 2, median, na.rm = TRUE),
  Q75 = apply(ChyuluHills.RPI.Values, 2, quantile, probs = 0.75, na.rm = TRUE)
)

print(ChyuluHills.Summary)
```

```{r}
## Extracting RPI for NgaiNdethia NR

NgaiNdethia.RPI.Values.Full <- terra::extract(NgaiNdethia.RPI.Crop, NgaiNdethia, cells = TRUE)

### Remove ID column (first column added by extract)
NgaiNdethia.RPI.Values <- NgaiNdethia.RPI.Values.Full[, names(NgaiNdethia.RPI.Crop)]

NgaiNdethia.Summary <- data.frame(
  Layer = names(NgaiNdethia.RPI.Crop),
  Mean = apply(NgaiNdethia.RPI.Values, 2, mean, na.rm = TRUE),
  SD = apply(NgaiNdethia.RPI.Values, 2, sd, na.rm = TRUE),
  Q25 = apply(NgaiNdethia.RPI.Values, 2, quantile, probs = 0.25, na.rm = TRUE),
  Median = apply(NgaiNdethia.RPI.Values, 2, median, na.rm = TRUE),
  Q75 = apply(NgaiNdethia.RPI.Values, 2, quantile, probs = 0.75, na.rm = TRUE)
)

print(NgaiNdethia.Summary)
```

```{r}
## Extracting RPI for SouthKitui NR

SouthKitui.RPI.Values.Full <- terra::extract(SouthKitui.RPI.Crop, SouthKitui, cells= TRUE)

### Remove ID column (first column added by extract)
SouthKitui.RPI.Values <- SouthKitui.RPI.Values.Full[, names(SouthKitui.RPI.Crop)]

SouthKitui.Summary <- data.frame(
  Layer = names(SouthKitui.RPI.Crop),
  Mean = apply(SouthKitui.RPI.Values, 2, mean, na.rm = TRUE),
  SD = apply(SouthKitui.RPI.Values, 2, sd, na.rm = TRUE),
  Q25 = apply(SouthKitui.RPI.Values, 2, quantile, probs = 0.25, na.rm = TRUE),
  Median = apply(SouthKitui.RPI.Values, 2, median, na.rm = TRUE),
  Q75 = apply(SouthKitui.RPI.Values, 2, quantile, probs = 0.75, na.rm = TRUE)
)

print(SouthKitui.Summary)
```

```{r}
## Extracting RPI for AET.Conservancies

AET.Conservancies.RPI.Values.Full <- terra::extract(AET.Conservancies.RPI.Crop, AET.Conservancies, cells= TRUE)

### Remove ID column (first column added by extract)
AET.Conservancies.RPI.Values <- AET.Conservancies.RPI.Values.Full[, names(AET.Conservancies.RPI.Crop)]

AET.Conservancies.Summary <- data.frame(
  Layer = names(AET.Conservancies.RPI.Crop),
  Mean = apply(AET.Conservancies.RPI.Values, 2, mean, na.rm = TRUE),
  SD = apply(AET.Conservancies.RPI.Values, 2, sd, na.rm = TRUE),
  Q25 = apply(AET.Conservancies.RPI.Values, 2, quantile, probs = 0.25, na.rm = TRUE),
  Median = apply(AET.Conservancies.RPI.Values, 2, median, na.rm = TRUE),
  Q75 = apply(AET.Conservancies.RPI.Values, 2, quantile, probs = 0.75, na.rm = TRUE)
)

print(AET.Conservancies.Summary)
```

```{r}
## Extracting RPI for AET.Buffers

AET.Buffers.RPI.Values.Full <- terra::extract(AET.Buffers.RPI.Crop, AET.Buffers, cells = TRUE)

### Remove ID column (first column added by extract)
AET.Buffers.RPI.Values <- AET.Buffers.RPI.Values.Full[, names(AET.Buffers.RPI.Crop)]

AET.Buffers.Summary <- data.frame(
  Layer = names(AET.Buffers.RPI.Crop),
  Mean = apply(AET.Buffers.RPI.Values, 2, mean, na.rm = TRUE),
  SD = apply(AET.Buffers.RPI.Values, 2, sd, na.rm = TRUE),
  Q25 = apply(AET.Buffers.RPI.Values, 2, quantile, probs = 0.25, na.rm = TRUE),
  Median = apply(AET.Buffers.RPI.Values, 2, median, na.rm = TRUE),
  Q75 = apply(AET.Buffers.RPI.Values, 2, quantile, probs = 0.75, na.rm = TRUE)
)

print(AET.Buffers.Summary)
```

```{r}
# Visualising Extracted RPI Values
```

```{r}
## Visualising Amboseli NP

Amboseli.RPI.Visual <- Amboseli.RPI.Values %>%
  mutate(ID = row_number()) %>%  # optional, to keep track of pixels
  pivot_longer(
    cols = -ID,                 # exclude ID column from pivoting
    names_to = "Layer",
    values_to = "RPI_value"
  ) %>%
  # Keep only layers starting with "rpi."
  filter(grepl("^rpi\\.", Layer)) %>%
  mutate(
    Year = as.integer(sub("rpi\\.", "", Layer)),
    Area = "Amboseli"
  ) %>%
  filter(!is.na(Year) & !is.na(RPI_value)) %>%  # remove NA years or RPI values
  select(ID, Area, Year, RPI_value) ## I will need "ID" for Trend Analysis (Theil-Sen)

# Now plot
ggplot(Amboseli.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_boxplot(fill = "lightblue", outlier.color = "red") +
  labs(
    title = "RPI Distribution Over Years in Amboseli NP",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising Amboseli NP (using a Violin Plot)

ggplot(Amboseli.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_violin(fill = "lightblue", color = "black", alpha = 0.7) +
  geom_boxplot(width = 0.1, outlier.color = "red", alpha = 0.5) +  # optional: overlay boxplot for summary stats
  labs(
    title = "RPI Distribution Over Years in Amboseli NP (Violin Plot)",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising TsavoEast NP

TsavoEast.RPI.Visual <- TsavoEast.RPI.Values %>%
  mutate(ID = row_number()) %>%  # optional, to keep track of pixels
  pivot_longer(
    cols = -ID,                 # exclude ID column from pivoting
    names_to = "Layer",
    values_to = "RPI_value"
  ) %>%
  # Keeps only layers starting with "rpi."
  filter(grepl("^rpi\\.", Layer)) %>%
  mutate(
    Year = as.integer(sub("rpi\\.", "", Layer)),
    Area = "TsavoEast"
  ) %>%
  filter(!is.na(Year) & !is.na(RPI_value)) %>%  # remove NA years or RPI values
  select(ID, Area, Year, RPI_value)

# Now plot
ggplot(TsavoEast.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_boxplot(fill = "lightblue", outlier.color = "red") +
  labs(
    title = "RPI Distribution Over Years in TsavoEast NP",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising TsavoEast NP (using a Violin Plot)

ggplot(TsavoEast.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_violin(fill = "lightblue", color = "black", alpha = 0.7) +
  geom_boxplot(width = 0.1, outlier.color = "red", alpha = 0.5) +  # optional: overlay boxplot for summary stats
  labs(
    title = "RPI Distribution Over Years in TsavoEast NP (Violin Plot)",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising TsavoWest NP

TsavoWest.RPI.Visual <- TsavoWest.RPI.Values %>%
  mutate(ID = row_number()) %>%  # optional, to keep track of pixels
  pivot_longer(
    cols = -ID,                 # exclude ID column from pivoting
    names_to = "Layer",
    values_to = "RPI_value"
  ) %>%
  # Keep only layers starting with "rpi."
  filter(grepl("^rpi\\.", Layer)) %>%
  mutate(
    Year = as.integer(sub("rpi\\.", "", Layer)),
    Area = "TsavoWest"
  ) %>%
  filter(!is.na(Year) & !is.na(RPI_value)) %>%  # remove NA years or RPI values
  select(ID, Area, Year, RPI_value)

# Now plot
ggplot(TsavoWest.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_boxplot(fill = "lightblue", outlier.color = "red") +
  labs(
    title = "RPI Distribution Over Years in TsavoWest NP",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising TsavoWest NP (using a Violin Plot)

ggplot(TsavoWest.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_violin(fill = "lightblue", color = "black", alpha = 0.7) +
  geom_boxplot(width = 0.1, outlier.color = "red", alpha = 0.5) +  # optional: overlay boxplot for summary stats
  labs(
    title = "RPI Distribution Over Years in TsavoWest NP (Violin Plot)",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising ChyuluHills NP

ChyuluHills.RPI.Visual <- ChyuluHills.RPI.Values %>%
  mutate(ID = row_number()) %>%  # optional, to keep track of pixels
  pivot_longer(
    cols = -ID,                 # exclude ID column from pivoting
    names_to = "Layer",
    values_to = "RPI_value"
  ) %>%
  # Keep only layers starting with "rpi."
  filter(grepl("^rpi\\.", Layer)) %>%
  mutate(
    Year = as.integer(sub("rpi\\.", "", Layer)),
    Area = "ChyuluHills"
  ) %>%
  filter(!is.na(Year) & !is.na(RPI_value)) %>%  # remove NA years or RPI values
  select(ID, Area, Year, RPI_value)

# Now plot
ggplot(ChyuluHills.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_boxplot(fill = "lightblue", outlier.color = "red") +
  labs(
    title = "RPI Distribution Over Years in ChyuluHills NP",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising ChyuluHills NP (using a Violin Plot)

ggplot(ChyuluHills.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_violin(fill = "lightblue", color = "black", alpha = 0.7) +
  geom_boxplot(width = 0.1, outlier.color = "red", alpha = 0.5) +  # optional: overlay boxplot for summary stats
  labs(
    title = "RPI Distribution Over Years in ChyuluHills NP (Violin Plot)",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising NgaiNdethia NR

NgaiNdethia.RPI.Visual <- NgaiNdethia.RPI.Values %>%
  mutate(ID = row_number()) %>%  # optional, to keep track of pixels
  pivot_longer(
    cols = -ID,                 # exclude ID column from pivoting
    names_to = "Layer",
    values_to = "RPI_value"
  ) %>%
  # Keep only layers starting with "rpi."
  filter(grepl("^rpi\\.", Layer)) %>%
  mutate(
    Year = as.integer(sub("rpi\\.", "", Layer)),
    Area = "NgaiNdethia"
  ) %>%
  filter(!is.na(Year) & !is.na(RPI_value)) %>%  # remove NA years or RPI values
  select(ID, Area, Year, RPI_value)

# Now plot
ggplot(NgaiNdethia.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_boxplot(fill = "lightblue", outlier.color = "red") +
  labs(
    title = "RPI Distribution Over Years in NgaiNdethia NR",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising NgaiNdethia NR (using a Violin Plot)

ggplot(NgaiNdethia.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_violin(fill = "lightblue", color = "black", alpha = 0.7) +
  geom_boxplot(width = 0.1, outlier.color = "red", alpha = 0.5) +  # optional: overlay boxplot for summary stats
  labs(
    title = "RPI Distribution Over Years in NgaiNdethia NR (Violin Plot)",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising SouthKitui NR

SouthKitui.RPI.Visual <- SouthKitui.RPI.Values %>%
  mutate(ID = row_number()) %>%  # optional, to keep track of pixels
  pivot_longer(
    cols = -ID,                 # exclude ID column from pivoting
    names_to = "Layer",
    values_to = "RPI_value"
  ) %>%
  # Keep only layers starting with "rpi."
  filter(grepl("^rpi\\.", Layer)) %>%
  mutate(
    Year = as.integer(sub("rpi\\.", "", Layer)),
    Area = "SouthKitui"
  ) %>%
  filter(!is.na(Year) & !is.na(RPI_value)) %>%  # remove NA years or RPI values
  select(ID, Area, Year, RPI_value)

# Now plot
ggplot(SouthKitui.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_boxplot(fill = "lightblue", outlier.color = "red") +
  labs(
    title = "RPI Distribution Over Years in SouthKitui NR",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising SouthKitui NR (using a Violin Plot)

ggplot(SouthKitui.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_violin(fill = "lightblue", color = "black", alpha = 0.7) +
  geom_boxplot(width = 0.1, outlier.color = "red", alpha = 0.5) +  # optional: overlay boxplot for summary stats
  labs(
    title = "RPI Distribution Over Years in SouthKitui NR (Violin Plot)",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising AET.Conservancies

AET.Conservancies.RPI.Visual <- AET.Conservancies.RPI.Values %>%
  mutate(ID = row_number()) %>%  # optional, to keep track of pixels
  pivot_longer(
    cols = -ID,                 # exclude ID column from pivoting
    names_to = "Layer",
    values_to = "RPI_value"
  ) %>%
  # Keep only layers starting with "rpi."
  filter(grepl("^rpi\\.", Layer)) %>%
  mutate(
    Year = as.integer(sub("rpi\\.", "", Layer)),
    Area = "AET.Conservancies"
  ) %>%
  filter(!is.na(Year) & !is.na(RPI_value)) %>%  # remove NA years or RPI values
  select(ID, Area, Year, RPI_value)

# Now plot
ggplot(AET.Conservancies.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_boxplot(fill = "lightblue", outlier.color = "red") +
  labs(
    title = "RPI Distribution Over Years in AET.Conservancies",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising AET.Conservancies (using a Violin Plot)

ggplot(AET.Conservancies.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_violin(fill = "lightblue", color = "black", alpha = 0.7) +
  geom_boxplot(width = 0.1, outlier.color = "red", alpha = 0.5) +  # optional: overlay boxplot for summary stats
  labs(
    title = "RPI Distribution Over Years in AET.Conservancies (Violin Plot)",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising AET.Buffers

AET.Buffers.RPI.Visual <- AET.Buffers.RPI.Values %>%
  mutate(ID = row_number()) %>%  # optional, to keep track of pixels
  pivot_longer(
    cols = -ID,                 # exclude ID column from pivoting
    names_to = "Layer",
    values_to = "RPI_value"
  ) %>%
  # Keep only layers starting with "rpi."
  filter(grepl("^rpi\\.", Layer)) %>%
  mutate(
    Year = as.integer(sub("rpi\\.", "", Layer)),
    Area = "AET.Buffers"
  ) %>%
  filter(!is.na(Year) & !is.na(RPI_value)) %>%  # remove NA years or RPI values
  select(ID, Area, Year, RPI_value)

# Now plot
ggplot(AET.Buffers.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_boxplot(fill = "lightblue", outlier.color = "red") +
  labs(
    title = "RPI Distribution Over Years in AET.Buffers",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising AET.Buffers (using a Violin Plot)

ggplot(AET.Buffers.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_violin(fill = "lightblue", color = "black", alpha = 0.7) +
  geom_boxplot(width = 0.1, outlier.color = "red", alpha = 0.5) +  # optional: overlay boxplot for summary stats
  labs(
    title = "RPI Distribution Over Years in AET.Buffers (Violin Plot)",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Conversation on refining the Violin plots:

# 1.Skepticism about RPI Fluctuations:
  # Do not fully trust year-to-year fluctuations in the (RPI).

#2.Focus on Comparisons:
  # Emphasise comparisons in:
    # (i) Average performance
    # (ii) Trends over time
  # Analyse these comparisons across different spatial units and/or management periods.

# 3. Signal vs. Noise:
  # Aim to focus on the real signal rather than the noise in the data.

# 4. Outlier Classification:
  # Recommend including arguments against disabling "outlier" classification.
  # Suggest that there are insufficient grounds to treat the red dots differently.
```

```{r}
## Visualising Amboseli NP

ggplot(Amboseli.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_violin(fill = "lightblue", color = "black", alpha = 0.7) +
  geom_boxplot(width = 0.1, outlier.shape = NA, alpha = 0.4) +  # removes red outlier dots
  stat_summary(fun = mean, geom = "line", aes(group = 1), color = "darkblue", linewidth = 0.6) + #Added mean line to get the general pattern
  stat_summary(fun = mean, geom = "point", shape = 21, fill = "purple", size = 2) + # Combined the mean line with points to make it easier to visualise
  labs(
    title = "RPI Distribution Over Years in Amboseli NP (Violin Plot)",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising Mean RPI over Amboseli NP as a line 

Amboseli.Mean <- Amboseli.RPI.Visual %>%
  group_by(Year) %>%
  summarise(Mean_RPI = mean(RPI_value, na.rm = TRUE))

ggplot(Amboseli.Mean, aes(x = Year, y = Mean_RPI)) +
  geom_line(color = "darkgreen", linewidth = 0.8) +
  geom_point(color = "black", fill = "purple", shape = 21, size = 2) +
  labs(
    title = "Mean RPI Over Time in Amboseli NP",
    x = "Year",
    y = "Mean RPI"
  ) +
  theme_beautiful()
```

```{r}
## Visualising TsavoEast NP

ggplot(TsavoEast.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_violin(fill = "lightblue", color = "black", alpha = 0.7) +
  geom_boxplot(width = 0.1, outlier.shape = NA, alpha = 0.4) +  # removes red outlier dots
  stat_summary(fun = mean, geom = "line", aes(group = 1), color = "darkblue", linewidth = 0.6) + #Added mean line to get the general pattern
  stat_summary(fun = mean, geom = "point", shape = 21, fill = "purple", size = 2) + # Combined the mean line with points to make it easier to visualise
  labs(
    title = "RPI Distribution Over Years in Tsavo East NP (Violin Plot)",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising Mean RPI over TsavoEast NP as a line 

TsavoEast.Mean <- TsavoEast.RPI.Visual %>%
  group_by(Year) %>%
  summarise(Mean_RPI = mean(RPI_value, na.rm = TRUE))

ggplot(TsavoEast.Mean, aes(x = Year, y = Mean_RPI)) +
  geom_line(color = "darkgreen", linewidth = 0.8) +
  geom_point(color = "black", fill = "purple", shape = 21, size = 2) +
  labs(
    title = "Mean RPI Over Time in Tsavo East NP",
    x = "Year",
    y = "Mean RPI"
  ) +
  theme_beautiful()
```

```{r}
## Visualising TsavoWest NP

ggplot(TsavoWest.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_violin(fill = "lightblue", color = "black", alpha = 0.7) +
  geom_boxplot(width = 0.1, outlier.shape = NA, alpha = 0.4) +  # removes red outlier dots
  stat_summary(fun = mean, geom = "line", aes(group = 1), color = "darkblue", linewidth = 0.6) + #Added mean line to get the general pattern
  stat_summary(fun = mean, geom = "point", shape = 21, fill = "purple", size = 2) + # Combined the mean line with points to make it easier to visualise
  labs(
    title = "RPI Distribution Over Years in Tsavo West NP (Violin Plot)",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising Mean RPI over TsavoWest NP as a line 

TsavoWest.Mean <- TsavoWest.RPI.Visual %>%
  group_by(Year) %>%
  summarise(Mean_RPI = mean(RPI_value, na.rm = TRUE))

ggplot(TsavoWest.Mean, aes(x = Year, y = Mean_RPI)) +
  geom_line(color = "darkgreen", linewidth = 0.8) +
  geom_point(color = "black", fill = "purple", shape = 21, size = 2) +
  labs(
    title = "Mean RPI Over Time in Tsavo West NP",
    x = "Year",
    y = "Mean RPI"
  ) +
  theme_beautiful()
```

```{r}
## Visualising ChyuluHills NP

ggplot(ChyuluHills.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_violin(fill = "lightblue", color = "black", alpha = 0.7) +
  geom_boxplot(width = 0.1, outlier.shape = NA, alpha = 0.4) +  # removes red outlier dots
  stat_summary(fun = mean, geom = "line", aes(group = 1), color = "darkblue", linewidth = 0.6) + #Added mean line to get the general pattern
  stat_summary(fun = mean, geom = "point", shape = 21, fill = "purple", size = 2) + # Combined the mean line with points to make it easier to visualise
  labs(
    title = "RPI Distribution Over Years in Chyulu Hills NP (Violin Plot)",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising Mean RPI over ChyuluHills NP as a line 

ChyuluHills.Mean <- ChyuluHills.RPI.Visual %>%
  group_by(Year) %>%
  summarise(Mean_RPI = mean(RPI_value, na.rm = TRUE))

ggplot(ChyuluHills.Mean, aes(x = Year, y = Mean_RPI)) +
  geom_line(color = "darkgreen", linewidth = 0.8) +
  geom_point(color = "black", fill = "purple", shape = 21, size = 2) +
  labs(
    title = "Mean RPI Over Time in Chyulu Hills NP",
    x = "Year",
    y = "Mean RPI"
  ) +
  theme_beautiful()
```

```{r}
## Visualising NgaiNdethia NR

ggplot(NgaiNdethia.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_violin(fill = "lightblue", color = "black", alpha = 0.7) +
  geom_boxplot(width = 0.1, outlier.shape = NA, alpha = 0.4) +  # removes red outlier dots
  stat_summary(fun = mean, geom = "line", aes(group = 1), color = "darkblue", linewidth = 0.6) + #Added mean line to get the general pattern
  stat_summary(fun = mean, geom = "point", shape = 21, fill = "purple", size = 2) + # Combined the mean line with points to make it easier to visualise
  labs(
    title = "RPI Distribution Over Years in Ngai Ndethia NR (Violin Plot)",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising Mean RPI over NgaiNdethia NR as a line 

NgaiNdethia.Mean <- NgaiNdethia.RPI.Visual %>%
  group_by(Year) %>%
  summarise(Mean_RPI = mean(RPI_value, na.rm = TRUE))

ggplot(NgaiNdethia.Mean, aes(x = Year, y = Mean_RPI)) +
  geom_line(color = "darkgreen", linewidth = 0.8) +
  geom_point(color = "black", fill = "purple", shape = 21, size = 2) +
  labs(
    title = "Mean RPI Over Time in Ngai Ndethia NR",
    x = "Year",
    y = "Mean RPI"
  ) +
  theme_beautiful()
```

```{r}
## Visualising SouthKitui NR

ggplot(SouthKitui.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_violin(fill = "lightblue", color = "black", alpha = 0.7) +
  geom_boxplot(width = 0.1, outlier.shape = NA, alpha = 0.4) +  # removes red outlier dots
  stat_summary(fun = mean, geom = "line", aes(group = 1), color = "darkblue", linewidth = 0.6) + #Added mean line to get the general pattern
  stat_summary(fun = mean, geom = "point", shape = 21, fill = "purple", size = 2) + # Combined the mean line with points to make it easier to visualise
  labs(
    title = "RPI Distribution Over Years in South Kitui NR (Violin Plot)",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising Mean RPI over SouthKitui NR as a line 

SouthKitui.Mean <- SouthKitui.RPI.Visual %>%
  group_by(Year) %>%
  summarise(Mean_RPI = mean(RPI_value, na.rm = TRUE))

ggplot(SouthKitui.Mean, aes(x = Year, y = Mean_RPI)) +
  geom_line(color = "darkgreen", linewidth = 0.8) +
  geom_point(color = "black", fill = "purple", shape = 21, size = 2) +
  labs(
    title = "Mean RPI Over Time in South Kitui NR",
    x = "Year",
    y = "Mean RPI"
  ) +
  theme_beautiful()
```

```{r}
## Visualising AET.Conservancies

ggplot(AET.Conservancies.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_violin(fill = "lightblue", color = "black", alpha = 0.7) +
  geom_boxplot(width = 0.1, outlier.shape = NA, alpha = 0.4) +  # removes red outlier dots
  stat_summary(fun = mean, geom = "line", aes(group = 1), color = "darkblue", linewidth = 0.6) + #Added mean line to get the general pattern
  stat_summary(fun = mean, geom = "point", shape = 21, fill = "purple", size = 2) + # Combined the mean line with points to make it easier to visualise
  labs(
    title = "RPI Distribution Over Years in AET.Conservancies (Violin Plot)",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising Mean RPI over AET.Conservancies as a line 

AET.Conservancies.Mean <- AET.Conservancies.RPI.Visual %>%
  group_by(Year) %>%
  summarise(Mean_RPI = mean(RPI_value, na.rm = TRUE))

ggplot(AET.Conservancies.Mean, aes(x = Year, y = Mean_RPI)) +
  geom_line(color = "darkgreen", linewidth = 0.8) +
  geom_point(color = "black", fill = "purple", shape = 21, size = 2) +
  labs(
    title = "Mean RPI Over Time in AET.Conservancies",
    x = "Year",
    y = "Mean RPI"
  ) +
  theme_beautiful()
```

```{r}
## Visualising AET.Buffers

## Visualising Amboseli NP

ggplot(AET.Buffers.RPI.Visual, aes(x = factor(Year), y = RPI_value)) +
  geom_violin(fill = "lightblue", color = "black", alpha = 0.7) +
  geom_boxplot(width = 0.1, outlier.shape = NA, alpha = 0.4) +  # removes red outlier dots
  stat_summary(fun = mean, geom = "line", aes(group = 1), color = "darkblue", linewidth = 0.6) + #Added mean line to get the general pattern
  stat_summary(fun = mean, geom = "point", shape = 21, fill = "purple", size = 2) + # Combined the mean line with points to make it easier to visualise
  labs(
    title = "RPI Distribution Over Years in AET.Buffers (Violin Plot)",
    x = "Year",
    y = "RPI Value"
  ) +
  theme_beautiful()
```

```{r}
## Visualising Mean RPI over AET.Buffers as a line 

AET.Buffers.Mean <- AET.Buffers.RPI.Visual %>%
  group_by(Year) %>%
  summarise(Mean_RPI = mean(RPI_value, na.rm = TRUE))

ggplot(AET.Buffers.Mean, aes(x = Year, y = Mean_RPI)) +
  geom_line(color = "darkgreen", linewidth = 0.8) +
  geom_point(color = "black", fill = "purple", shape = 21, size = 2) +
  labs(
    title = "Mean RPI Over Time in AET.Buffers",
    x = "Year",
    y = "Mean RPI"
  ) +
  theme_beautiful()
```

```{r}
# Estimating Theil-Sen Slope Trends
```

```{r}
## Theil-Sen across Amboseli NP

  # Sorting data by "Year" & "ID"
Amboseli.RPI.Visual.Arranged <- Amboseli.RPI.Visual %>% arrange(ID, Year)

# Split data by pixel ID
Amboseli.Pixel.List <- Amboseli.RPI.Visual.Arranged %>% group_split(ID)

# Apply sens.slope to each pixel group
Amboseli.TheilSen <- map_dfr(Amboseli.Pixel.List, function(df) {
  if (sum(!is.na(df$RPI_value)) >= 3) {
    slope <- tryCatch(
      sens.slope(df$RPI_value)$estimates,
      error = function(e) NA_real_
    )
  } else {
    slope <- NA_real_
  }
  tibble(ID = unique(df$ID), Slope = slope)
})

  # Joining slope results back with area info
Amboseli.TheilSen <- Amboseli.TheilSen %>%
  mutate(Area = "Amboseli")

  # Getting overall summary per area
Amboseli.SummaryTrend <- Amboseli.TheilSen %>%
  summarise(
    MeanSlope = mean(Slope, na.rm = TRUE),
    MedianSlope = median(Slope, na.rm = TRUE),
    SD = sd(Slope, na.rm = TRUE),
    N = sum(!is.na(Slope))
  )
```

```{r}
## Theil-Sen across TsavoEast NP

  # Sorting data by "Year" & "ID"
TsavoEast.RPI.Visual.Arranged <- TsavoEast.RPI.Visual %>% arrange(ID, Year)

# Split data by pixel ID
TsavoEast.Pixel.List <- TsavoEast.RPI.Visual.Arranged %>% group_split(ID)

# Apply sens.slope to each pixel group
TsavoEast.TheilSen <- map_dfr(TsavoEast.Pixel.List, function(df) {
  if (sum(!is.na(df$RPI_value)) >= 3) {
    slope <- tryCatch(
      sens.slope(df$RPI_value)$estimates,
      error = function(e) NA_real_
    )
  } else {
    slope <- NA_real_
  }
  tibble(ID = unique(df$ID), Slope = slope)
})

  # Joining slope results back with area info
TsavoEast.TheilSen <- TsavoEast.TheilSen %>%
  mutate(Area = "TsavoEast")

  # Getting overall summary per area
TsavoEast.SummaryTrend <- TsavoEast.TheilSen %>%
  summarise(
    MeanSlope = mean(Slope, na.rm = TRUE),
    MedianSlope = median(Slope, na.rm = TRUE),
    SD = sd(Slope, na.rm = TRUE),
    N = sum(!is.na(Slope))
  )
```

```{r}
## Theil-Sen across TsavoWest NP

  # Sorting data by "Year" & "ID"
TsavoWest.RPI.Visual.Arranged <- TsavoWest.RPI.Visual %>% arrange(ID, Year)

# Split data by pixel ID
TsavoWest.Pixel.List <- TsavoWest.RPI.Visual.Arranged %>% group_split(ID)

# Apply sens.slope to each pixel group
TsavoWest.TheilSen <- map_dfr(TsavoWest.Pixel.List, function(df) {
  if (sum(!is.na(df$RPI_value)) >= 3) {
    slope <- tryCatch(
      sens.slope(df$RPI_value)$estimates,
      error = function(e) NA_real_
    )
  } else {
    slope <- NA_real_
  }
  tibble(ID = unique(df$ID), Slope = slope)
})

  # Joining slope results back with area info
TsavoWest.TheilSen <- TsavoWest.TheilSen %>%
  mutate(Area = "TsavoWest")

  # Getting overall summary per area
TsavoWest.SummaryTrend <- TsavoWest.TheilSen %>%
  summarise(
    MeanSlope = mean(Slope, na.rm = TRUE),
    MedianSlope = median(Slope, na.rm = TRUE),
    SD = sd(Slope, na.rm = TRUE),
    N = sum(!is.na(Slope))
  )
```

```{r}
## Theil-Sen across ChyuluHills NP

  # Sorting data by "Year" & "ID"
ChyuluHills.RPI.Visual.Arranged <- ChyuluHills.RPI.Visual %>% arrange(ID, Year)

# Split data by pixel ID 
    #{"group_split()" - apply a time-series analysis function independently to the time serieS associated with each distinct spatial unit/pixel}
ChyuluHills.Pixel.List <- ChyuluHills.RPI.Visual.Arranged %>% group_split(ID)

# Apply sens.slope to each pixel group
ChyuluHills.TheilSen <- map_dfr(ChyuluHills.Pixel.List, function(df) {
  if (sum(!is.na(df$RPI_value)) >= 3) {
    slope <- tryCatch(
      sens.slope(df$RPI_value)$estimates,
      error = function(e) NA_real_
    )
  } else {
    slope <- NA_real_
  }
  tibble(ID = unique(df$ID), Slope = slope)
})

  # Joining slope results back with area info
ChyuluHills.TheilSen <- ChyuluHills.TheilSen %>%
  mutate(Area = "ChyuluHills")

  # Getting overall summary per area
ChyuluHills.SummaryTrend <- ChyuluHills.TheilSen %>%
  summarise(
    MeanSlope = mean(Slope, na.rm = TRUE),
    MedianSlope = median(Slope, na.rm = TRUE),
    SD = sd(Slope, na.rm = TRUE),
    N = sum(!is.na(Slope))
  )
```

```{r}
## Theil-Sen across NgaiNdethia NR

  # Sorting data by "Year" & "ID"
NgaiNdethia.RPI.Visual.Arranged <- NgaiNdethia.RPI.Visual %>% arrange(ID, Year)

# Split data by pixel ID
NgaiNdethia.Pixel.List <- NgaiNdethia.RPI.Visual.Arranged %>% group_split(ID)

# Apply sens.slope to each pixel group
NgaiNdethia.TheilSen <- map_dfr(NgaiNdethia.Pixel.List, function(df) {
  if (sum(!is.na(df$RPI_value)) >= 3) {
    slope <- tryCatch(
      sens.slope(df$RPI_value)$estimates,
      error = function(e) NA_real_
    )
  } else {
    slope <- NA_real_
  }
  tibble(ID = unique(df$ID), Slope = slope)
})

  # Joining slope results back with area info
NgaiNdethia.TheilSen <- NgaiNdethia.TheilSen %>%
  mutate(Area = "NgaiNdethia")

  # Getting overall summary per area
NgaiNdethia.SummaryTrend <- NgaiNdethia.TheilSen %>%
  summarise(
    MeanSlope = mean(Slope, na.rm = TRUE),
    MedianSlope = median(Slope, na.rm = TRUE),
    SD = sd(Slope, na.rm = TRUE),
    N = sum(!is.na(Slope))
  )
```

```{r}
## Theil-Sen across SouthKitui NR

  # Sorting data by "Year" & "ID"
SouthKitui.RPI.Visual.Arranged <- SouthKitui.RPI.Visual %>% arrange(ID, Year)

# Split data by pixel ID
SouthKitui.Pixel.List <- SouthKitui.RPI.Visual.Arranged %>% group_split(ID)

# Apply sens.slope to each pixel group
SouthKitui.TheilSen <- map_dfr(SouthKitui.Pixel.List, function(df) {
  if (sum(!is.na(df$RPI_value)) >= 3) {
    slope <- tryCatch(
      sens.slope(df$RPI_value)$estimates,
      error = function(e) NA_real_
    )
  } else {
    slope <- NA_real_
  }
  tibble(ID = unique(df$ID), Slope = slope)
})

  # Joining slope results back with area info
SouthKitui.TheilSen <- SouthKitui.TheilSen %>%
  mutate(Area = "SouthKitui")

  # Getting overall summary per area
SouthKitui.SummaryTrend <- SouthKitui.TheilSen %>%
  summarise(
    MeanSlope = mean(Slope, na.rm = TRUE),
    MedianSlope = median(Slope, na.rm = TRUE),
    SD = sd(Slope, na.rm = TRUE),
    N = sum(!is.na(Slope))
  )
```

```{r}
## Theil-Sen across AET.Conservancies

  # Sorting data by "Year" & "ID"
AET.Conservancies.RPI.Visual.Arranged <- AET.Conservancies.RPI.Visual %>% arrange(ID, Year)

# Split data by pixel ID
AET.Conservancies.Pixel.List <- AET.Conservancies.RPI.Visual.Arranged %>% group_split(ID)

# Apply sens.slope to each pixel group
AET.Conservancies.TheilSen <- map_dfr(AET.Conservancies.Pixel.List, function(df) {
  if (sum(!is.na(df$RPI_value)) >= 3) {
    slope <- tryCatch(
      sens.slope(df$RPI_value)$estimates,
      error = function(e) NA_real_
    )
  } else {
    slope <- NA_real_
  }
  tibble(ID = unique(df$ID), Slope = slope)
})

  # Joining slope results back with area info
AET.Conservancies.TheilSen <- AET.Conservancies.TheilSen %>%
  mutate(Area = "Amboseli")

  # Getting overall summary per area
AET.Conservancies.SummaryTrend <- AET.Conservancies.TheilSen %>%
  summarise(
    MeanSlope = mean(Slope, na.rm = TRUE),
    MedianSlope = median(Slope, na.rm = TRUE),
    SD = sd(Slope, na.rm = TRUE),
    N = sum(!is.na(Slope))
  )
```

```{r}
## Theil-Sen across AET.Buffers

  # Sorting data by "Year" & "ID"
AET.Buffers.RPI.Visual.Arranged <- AET.Buffers.RPI.Visual %>% arrange(ID, Year)

# Split data by pixel ID
AET.Buffers.Pixel.List <- AET.Buffers.RPI.Visual.Arranged %>% group_split(ID)

# Apply sens.slope to each pixel group
AET.Buffers.TheilSen <- map_dfr(AET.Buffers.Pixel.List, function(df) {
  if (sum(!is.na(df$RPI_value)) >= 3) {
    slope <- tryCatch(
      sens.slope(df$RPI_value)$estimates,
      error = function(e) NA_real_
    )
  } else {
    slope <- NA_real_
  }
  tibble(ID = unique(df$ID), Slope = slope)
})

  # Joining slope results back with area info
AET.Buffers.TheilSen <- AET.Buffers.TheilSen %>%
  mutate(Area = "AET.Buffers")

  # Getting overall summary per area
AET.Buffers.SummaryTrend <- AET.Buffers.TheilSen %>%
  summarise(
    MeanSlope = mean(Slope, na.rm = TRUE),
    MedianSlope = median(Slope, na.rm = TRUE),
    SD = sd(Slope, na.rm = TRUE),
    N = sum(!is.na(Slope))
  )
```

```{r}
# Visualising MeanSlope across study area

All.Pixel.Slopes <- bind_rows(
  Amboseli.TheilSen, TsavoEast.TheilSen, TsavoWest.TheilSen, ChyuluHills.TheilSen,
  NgaiNdethia.TheilSen, SouthKitui.TheilSen, AET.Conservancies.TheilSen, AET.Buffers.TheilSen)


All.Trends.Summary <- All.Pixel.Slopes %>%
  group_by(Area) %>%
  summarise(
    MeanSlope = mean(Slope, na.rm = TRUE),
    MedianSlope = median(Slope, na.rm = TRUE),
    SD = sd(Slope, na.rm = TRUE),
    N = sum(!is.na(Slope)),
    .groups = "drop"
  )
    ## All.Trends.Summary summarises the overall direction and strength of change in RPI for each area over the full time series.


ggplot(All.Trends.Summary, aes(x = reorder(Area, MeanSlope), y = MeanSlope)) +
  geom_col(fill = "steelblue", color = "black") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "darkred") +
  labs(
    title = "Mean RPI Trend (TheilSen) by Area",
    x = "Area",
    y = "Mean Slope"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
## Visualising Violin Plot to compare across the study area

ggplot(All.Pixel.Slopes, aes(x = Area, y = Slope, fill = Area)) +
  geom_violin(trim = FALSE) +
  geom_boxplot(width = 0.1, outlier.shape = NA) +
  labs(title = "Distribution of RPI Trends (TheilSen Slopes) by Area", x = "Area", y = "Slope") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
# Creating Raster Maps of Theil-Sen Slopes
```

```{r}
## Amboseli Raster Map of Theil-Sen Slopes

# 1. I shall use the original raster as a template using only 1 layer for structure
Amboseli.Slope.Raster <- terra::rast(Amboseli.RPI.Crop[[1]])
terra::values(Amboseli.Slope.Raster) <- NA  # blank it out

# 2. I shall then link slope values to cell numbers
Amboseli.Cell.Map <- data.frame(ID = 1:nrow(Amboseli.RPI.Values.Full), cell = Amboseli.RPI.Values.Full$cell)

  # Merging slopes with cells
Amboseli.Slope.Cells <- dplyr::left_join(Amboseli.TheilSen, Amboseli.Cell.Map, by = "ID")

# 3. Populate slope values into raster cells
Amboseli.Slope.Raster[Amboseli.Slope.Cells$cell] <- Amboseli.Slope.Cells$Slope

# 4. Plot the raster
tm_shape(Amboseli.Slope.Raster) +
  tm_raster(
    col.scale = tm_scale_continuous(values = "rd_bu", midpoint = 0),
    col.legend = tm_legend(title = "TheilSen Slope")
  ) +
  tm_title("Spatial Distribution of RPI Trends  Amboseli") +
  tm_layout(legend.outside = TRUE)
```

```{r}
## TsavoEast Raster Map of Theil-Sen Slopes

# 1. I shall use the original raster as a template using only 1 layer for structure
TsavoEast.Slope.Raster <- terra::rast(TsavoEast.RPI.Crop[[1]])
terra::values(TsavoEast.Slope.Raster) <- NA  # blank it out

# 2. I shall then link slope values to cell numbers
TsavoEast.Cell.Map <- data.frame(ID = 1:nrow(TsavoEast.RPI.Values.Full), cell = TsavoEast.RPI.Values.Full$cell)

  # Merging slopes with cells
TsavoEast.Slope.Cells <- dplyr::left_join(TsavoEast.TheilSen, TsavoEast.Cell.Map, by = "ID")

# 3. Populate slope values into raster cells
TsavoEast.Slope.Raster[TsavoEast.Slope.Cells$cell] <- TsavoEast.Slope.Cells$Slope

# 4. Plot the raster
tm_shape(TsavoEast.Slope.Raster) +
  tm_raster(
    col.scale = tm_scale_continuous(values = "rd_bu", midpoint = 0),
    col.legend = tm_legend(title = "TheilSen Slope")
  ) +
  tm_title("Spatial Distribution of RPI Trends  Tsavo East") +
  tm_layout(legend.outside = TRUE)
```

```{r}
## TsavoWest Raster Map of Theil-Sen Slopes

# 1. I shall use the original raster as a template using only 1 layer for structure
TsavoWest.Slope.Raster <- terra::rast(TsavoWest.RPI.Crop[[1]])
terra::values(TsavoWest.Slope.Raster) <- NA  # blank it out

# 2. I shall then link slope values to cell numbers
TsavoWest.Cell.Map <- data.frame(ID = 1:nrow(TsavoWest.RPI.Values.Full), cell = TsavoWest.RPI.Values.Full$cell)

  # Merging slopes with cells
TsavoWest.Slope.Cells <- dplyr::left_join(TsavoWest.TheilSen, TsavoWest.Cell.Map, by = "ID")

# 3. Populate slope values into raster cells
TsavoWest.Slope.Raster[TsavoWest.Slope.Cells$cell] <- TsavoWest.Slope.Cells$Slope

# 4. Plot the raster
tm_shape(TsavoWest.Slope.Raster) +
  tm_raster(
    col.scale = tm_scale_continuous(values = "rd_bu", midpoint = 0),
    col.legend = tm_legend(title = "TheilSen Slope")
  ) +
  tm_title("Spatial Distribution of RPI Trends  Tsavo West") +
  tm_layout(legend.outside = TRUE)
```

```{r}
## ChyuluHills Raster Map of Theil-Sen Slopes

# 1. I shall use the original raster as a template using only 1 layer for structure
ChyuluHills.Slope.Raster <- terra::rast(ChyuluHills.RPI.Crop[[1]])
terra::values(ChyuluHills.Slope.Raster) <- NA  # blank it out

# 2. I shall then link slope values to cell numbers
ChyuluHills.Cell.Map <- data.frame(ID = 1:nrow(ChyuluHills.RPI.Values.Full), cell = ChyuluHills.RPI.Values.Full$cell)

  # Merging slopes with cells
ChyuluHills.Slope.Cells <- dplyr::left_join(ChyuluHills.TheilSen, ChyuluHills.Cell.Map, by = "ID")

# 3. Populate slope values into raster cells
ChyuluHills.Slope.Raster[ChyuluHills.Slope.Cells$cell] <- ChyuluHills.Slope.Cells$Slope

# 4. Plot the raster
tm_shape(ChyuluHills.Slope.Raster) +
  tm_raster(
    col.scale = tm_scale_continuous(values = "rd_bu", midpoint = 0),
    col.legend = tm_legend(title = "TheilSen Slope")
  ) +
  tm_title("Spatial Distribution of RPI Trends  Chyulu Hills") +
  tm_layout(legend.outside = TRUE)
```

```{r}
## NgaiNdethia Raster Map of Theil-Sen Slopes

# 1. I shall use the original raster as a template using only 1 layer for structure
NgaiNdethia.Slope.Raster <- terra::rast(NgaiNdethia.RPI.Crop[[1]])
terra::values(NgaiNdethia.Slope.Raster) <- NA  # blank it out

# 2. I shall then link slope values to cell numbers
NgaiNdethia.Cell.Map <- data.frame(ID = 1:nrow(NgaiNdethia.RPI.Values.Full), cell = NgaiNdethia.RPI.Values.Full$cell)

  # Merging slopes with cells
NgaiNdethia.Slope.Cells <- dplyr::left_join(NgaiNdethia.TheilSen, NgaiNdethia.Cell.Map, by = "ID")

# 3. Populate slope values into raster cells
NgaiNdethia.Slope.Raster[NgaiNdethia.Slope.Cells$cell] <- NgaiNdethia.Slope.Cells$Slope

# 4. Plot the raster
tm_shape(NgaiNdethia.Slope.Raster) +
  tm_raster(
    col.scale = tm_scale_continuous(values = "rd_bu", midpoint = 0),
    col.legend = tm_legend(title = "TheilSen Slope")
  ) +
  tm_title("Spatial Distribution of RPI Trends  Ngai Ndethia") +
  tm_layout(legend.outside = TRUE)
```

```{r}
## SouthKitui Raster Map of Theil-Sen Slopes

# 1. I shall use the original raster as a template using only 1 layer for structure
SouthKitui.Slope.Raster <- terra::rast(SouthKitui.RPI.Crop[[1]])
terra::values(SouthKitui.Slope.Raster) <- NA  # blank it out

# 2. I shall then link slope values to cell numbers
SouthKitui.Cell.Map <- data.frame(ID = 1:nrow(SouthKitui.RPI.Values.Full), cell = SouthKitui.RPI.Values.Full$cell)

  # Merging slopes with cells
SouthKitui.Slope.Cells <- dplyr::left_join(SouthKitui.TheilSen, SouthKitui.Cell.Map, by = "ID")

# 3. Populate slope values into raster cells
SouthKitui.Slope.Raster[SouthKitui.Slope.Cells$cell] <- SouthKitui.Slope.Cells$Slope

# 4. Plot the raster
tm_shape(SouthKitui.Slope.Raster) +
  tm_raster(
    col.scale = tm_scale_continuous(values = "rd_bu", midpoint = 0),
    col.legend = tm_legend(title = "TheilSen Slope")
  ) +
  tm_title("Spatial Distribution of RPI Trends  South Kitui") +
  tm_layout(legend.outside = TRUE)
```

```{r}
## AET.Conservancies Raster Map of Theil-Sen Slopes

# 1. I shall use the original raster as a template using only 1 layer for structure
AET.Conservancies.Slope.Raster <- terra::rast(AET.Conservancies.RPI.Crop[[1]])
terra::values(AET.Conservancies.Slope.Raster) <- NA  # blank it out

# 2. I shall then link slope values to cell numbers
AET.Conservancies.Cell.Map <- data.frame(ID = 1:nrow(AET.Conservancies.RPI.Values.Full), cell = AET.Conservancies.RPI.Values.Full$cell)

  # Merging slopes with cells
AET.Conservancies.Slope.Cells <- dplyr::left_join(AET.Conservancies.TheilSen, AET.Conservancies.Cell.Map, by = "ID")

# 3. Populate slope values into raster cells
AET.Conservancies.Slope.Raster[AET.Conservancies.Slope.Cells$cell] <- AET.Conservancies.Slope.Cells$Slope

# 4. Plot the raster
tm_shape(AET.Conservancies.Slope.Raster) +
  tm_raster(
    col.scale = tm_scale_continuous(values = "rd_bu", midpoint = 0),
    col.legend = tm_legend(title = "TheilSen Slope")
  ) +
  tm_title("Spatial Distribution of RPI Trends  AET Conservancies") +
  tm_layout(legend.outside = TRUE)
```

```{r}
## AET.Buffers Raster Map of Theil-Sen Slopes

# 1. I shall use the original raster as a template using only 1 layer for structure
AET.Buffers.Slope.Raster <- terra::rast(AET.Buffers.RPI.Crop[[1]])
terra::values(AET.Buffers.Slope.Raster) <- NA  # blank it out

# 2. I shall then link slope values to cell numbers
AET.Buffers.Cell.Map <- data.frame(ID = 1:nrow(AET.Buffers.RPI.Values.Full), cell = AET.Buffers.RPI.Values.Full$cell)

  # Merging slopes with cells
AET.Buffers.Slope.Cells <- dplyr::left_join(AET.Buffers.TheilSen, AET.Buffers.Cell.Map, by = "ID")

# 3. Populate slope values into raster cells
AET.Buffers.Slope.Raster[AET.Buffers.Slope.Cells$cell] <- AET.Buffers.Slope.Cells$Slope

# 4. Plot the raster
tm_shape(AET.Buffers.Slope.Raster) +
  tm_raster(
    col.scale = tm_scale_continuous(values = "rd_bu", midpoint = 0),
    col.legend = tm_legend(title = "TheilSen Slope")
  ) +
  tm_title("Spatial Distribution of RPI Trends  AET Buffers") +
  tm_layout(legend.outside = TRUE)
```

```{r}
# Further Analysis
```

```{r}
## Grouping Study Area Information

Study.Area <- tibble::tibble(
  Area = c("TsavoEast", "TsavoWest", "Amboseli", "ChyuluHills",
           "NgaiNdethia", "SouthKitui", "AET.Conservancies", "AET.Buffers"),
  ProtectionType = c("NationalPark", "NationalPark", "NationalPark", "NationalPark",
                     "NationalReserve", "NationalReserve", "CommunityLand", "CommunityLand"))
```

```{r}
## Joining Governance Metadata to Pixel Level Slope Data

All.Pixel.Slopes <- All.Pixel.Slopes %>%
  left_join(Study.Area, by = "Area")

## Visualising Theil-Sen Slope Trends by Protection Type

ggplot(All.Pixel.Slopes, aes(x = ProtectionType, y = Slope, fill = ProtectionType)) +
  geom_violin(trim = FALSE, alpha = 0.7) +
  geom_boxplot(width = 0.1, outlier.shape = NA, alpha = 0.5, color = "black") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "darkred") +
  labs(
    title = "Distribution of RPI Trends by Governance Type",
    x = "Governance Category",
    y = "TheilSen Slope"
  ) +
  scale_fill_brewer(palette = "Set2") +
  theme_beautiful()
```

```{r}
## Checking out Summary Statistics by Protection Type

Governance.Summary <- All.Pixel.Slopes %>%
  group_by(ProtectionType) %>%
  summarise(
    MeanSlope = mean(Slope, na.rm = TRUE),
    MedianSlope = median(Slope, na.rm = TRUE),
    SD = sd(Slope, na.rm = TRUE),
    N = sum(!is.na(Slope)),
    .groups = "drop"
  )

print(Governance.Summary)
```

```{r}
## Stats 1: Kruskal-Wallis Test

kruskal.test(Slope ~ ProtectionType, data = All.Pixel.Slopes)
```

```{r}
## Stats 2: Pairwise Wilcoxon Tests

pairwise.wilcox.test(All.Pixel.Slopes$Slope, All.Pixel.Slopes$ProtectionType, p.adjust.method = "bonferroni")
```

```{r}
# Temporal Trends across Years
```

```{r}
## Yearly summary data

# Combining all pixel values with area info
All.Pixel.Values <- bind_rows(
  Amboseli.RPI.Visual, TsavoEast.RPI.Visual, TsavoWest.RPI.Visual, ChyuluHills.RPI.Visual,
  NgaiNdethia.RPI.Visual, SouthKitui.RPI.Visual, AET.Conservancies.RPI.Visual, 
  AET.Buffers.RPI.Visual)

# Grouping by Year and Area to compute annual means
Annual.RPI.Trends <- All.Pixel.Values %>%
  group_by(Area, Year) %>%
  summarise(MeanRPI = mean(RPI_value, na.rm = TRUE), .groups = "drop")

# Visualising Annual RPI Trends

ggplot(Annual.RPI.Trends, aes(x = Year, y = MeanRPI, color = Area)) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  labs(title = "Annual Mean RPI Trends by Area", x = "Year", y = "Mean RPI") +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom") +
  theme_beautiful()
```

```{r}
## Zooming into the Areas of Primary Concern

Primary.Concern.Areas <- bind_rows(Amboseli.RPI.Visual, TsavoEast.RPI.Visual, TsavoWest.RPI.Visual, AET.Conservancies.RPI.Visual, AET.Buffers.RPI.Visual)

# Grouping by Year and Area to compute annual means
Primary.Concern.Areas.RPI.Trends <- Primary.Concern.Areas %>%
  group_by(Area, Year) %>%
  summarise(MeanRPI = mean(RPI_value, na.rm = TRUE), .groups = "drop")

    # "Primary.Concern.Areas.RPI.Trends" calculated the annual average RPI for each Area

# Visualising Annual RPI Trends for Primary Concern Areas
ggplot(Primary.Concern.Areas.RPI.Trends, aes(x = Year, y = MeanRPI, color = Area)) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  labs(title = "Annual Mean RPI Trends in Primary Concern Areas", x = "Year", y = "Mean RPI") +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom") +
  theme_beautiful()
```

```{r}
# Stastistical Analysis of Temporal Trends

# Fitting a linear model

lm_test <- lm(MeanRPI ~ Year * Area, data = Primary.Concern.Areas.RPI.Trends)
anova(lm_test)
summary(lm_test)
```

```{r}
## Explanation of Results above:
# The ANOVA results indicate whether there are significant differences in RPI trends across different areas and years.

# The summary provides coefficients for the linear model, showing how RPI changes with each year and area.

  # Area is highly significant (p < 0.001)  Different areas have different mean RPI levels.

  # Year is not significant  No overall temporal trend across all areas.

  # Year  Area is not significant (but close at p = 0.127)  Trend differences across areas are not statistically strong, but there are hints that Tsavo East is rising faster (Year:AreaTsavoEast is significant).
```

```{r}
# Visualising Temporal Trends in Primary Concern Areas

Primary.Pixel.Slopes <- All.Pixel.Slopes %>%
  filter(Area %in% c("Amboseli", "TsavoEast", "TsavoWest", "AET.Conservancies", "AET.Buffers"))

ggplot(Primary.Pixel.Slopes, aes(x = Area, y = Slope, fill = Area)) +
  geom_violin(trim = FALSE) +
  geom_boxplot(width = 0.1, outlier.shape = NA, color = "black") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "darkred") +
  labs(title = "RPI Pixel Trend Distributions in Key Areas",
       x = "Area", y = "TheilSen Slope") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_beautiful()
```

```{r}
# Mapping Per-Pixel Slope for the Primary Concern Areas


tmap_mode("view")  # placed "view" in stead of "plot" for interactiveness

tmap_arrange(
  tm_shape(Amboseli.Slope.Raster) +
    tm_raster(
      col.scale = tm_scale_continuous(values = "rd_bu", midpoint = 0),
      col.legend = tm_legend(title = "Slope")
    ) +
    tm_title("Amboseli"),

  tm_shape(TsavoEast.Slope.Raster) +
    tm_raster(
      col.scale = tm_scale_continuous(values = "rd_bu", midpoint = 0),
      col.legend = tm_legend(title = "Slope")
    ) +
    tm_title("Tsavo East"),

  tm_shape(TsavoWest.Slope.Raster) +
    tm_raster(
      col.scale = tm_scale_continuous(values = "rd_bu", midpoint = 0),
      col.legend = tm_legend(title = "Slope")
    ) +
    tm_title("Tsavo West"),

  tm_shape(AET.Conservancies.Slope.Raster) +
    tm_raster(
      col.scale = tm_scale_continuous(values = "rd_bu", midpoint = 0),
      col.legend = tm_legend(title = "Slope")
    ) +
    tm_title("AET Conservancies"),

  tm_shape(AET.Buffers.Slope.Raster) +
    tm_raster(
      col.scale = tm_scale_continuous(values = "rd_bu", midpoint = 0),
      col.legend = tm_legend(title = "Slope")
    ) +
    tm_title("AET Buffers"),

  ncol = 2, nrow = 3  # Balanced grid
)


  # Saving the maps as a PNG file
    # tmap_save(filename = "RPI_Slope_Maps_ConcernAreas.png", width = 10, height = 8, dpi = 300)
```

```{r}

```

```{r}
```